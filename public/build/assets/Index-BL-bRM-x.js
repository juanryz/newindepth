import{u as o,r as x,j as e,H}from"./app-7VUgG5_d.js";import{A as F}from"./AuthenticatedLayout-y0hcZLIi.js";import{M as f,S as w}from"./SecondaryButton-D0s7FkW9.js";import{I as i}from"./InputLabel-BL_xtaMe.js";import"./transition-BKLBwnF-.js";import"./ThemeToggle-BbIlZNpb.js";import"./LiquidBackground-CS_M1rwF.js";import"./with-selector-DuZRq4jM.js";function $({bookings:h,therapists:b,availableSchedules:N=[]}){const{data:m,setData:p,patch:_,processing:u}=o({therapist_id:""}),[v,l]=x.useState(null),[a,n]=x.useState(null),[d,r]=x.useState(null),{data:c,setData:g,post:k,processing:S,reset:B}=o({new_schedule_id:"",reschedule_reason:""}),{data:j,setData:y,post:D,processing:C,reset:P}=o({no_show_party:"therapist",no_show_reason:""}),T=t=>{_(route("admin.bookings.assign-therapist",t),{onSuccess:()=>l(null)})},L=t=>{t.preventDefault(),k(route("admin.bookings.reschedule",a.id),{onSuccess:()=>{n(null),B()}})},M=t=>{t.preventDefault(),D(route("admin.bookings.no-show",d.id),{onSuccess:()=>{r(null),P()}})},A=t=>{const s={pending_screening:"bg-yellow-100 text-yellow-800",pending_payment:"bg-blue-100 text-blue-800",pending_validation:"bg-indigo-100 text-indigo-800",confirmed:"bg-green-100 text-green-800",completed:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800"},R={pending_screening:"Menunggu Skrining",pending_payment:"Menunggu Pembayaran",pending_validation:"Menunggu Validasi",confirmed:"Dikonfirmasi",completed:"Selesai",cancelled:"Dibatalkan"};return e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s[t]||s.pending_payment}`,children:R[t]||t})};return e.jsxs(F,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Manajemen Booking Pasien"}),children:[e.jsx(H,{title:"Booking Pasien"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"p-6 bg-white border-b border-gray-200 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kode"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pasien"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Profil"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Skrining"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Jadwal Sesi"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Terapis"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[h.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("div",{className:"font-medium text-gray-900",children:t.booking_code})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.patient?.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.patient?.email})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mb-1 max-w-[100px]",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.patient_profile_stats?.percentage===100?"bg-green-600":"bg-yellow-500"}`,style:{width:`${t.patient_profile_stats?.percentage||0}%`}})}),e.jsxs("span",{className:"text-xs font-semibold",children:[t.patient_profile_stats?.percentage||0,"% Lengkap"]}),t.patient?.agreement_signed_at?e.jsx("span",{className:"text-[10px] text-green-600 font-bold uppercase mt-1",children:"✓ Perjanjian TTD"}):e.jsx("span",{className:"text-[10px] text-red-500 font-bold uppercase mt-1",children:"✗ Belum TTD"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.patient?.screening_completed_at?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs text-green-700 font-medium",children:["Selesai: ",new Date(t.patient.screening_completed_at).toLocaleDateString("id-ID")]}),e.jsxs("span",{className:"text-xs italic text-gray-500 truncate max-w-[150px]",children:["Pesan: ",t.patient.recommended_package||"-"]})]}):e.jsx("span",{className:"text-xs text-red-400 italic",children:"Belum skrining"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.schedule?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:new Date(t.schedule.date).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})}),e.jsxs("div",{className:"text-xs",children:[t.schedule.start_time?.substring(0,5)||"--:--"," - ",t.schedule.end_time?.substring(0,5)||"--:--"]})]}):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[A(t.status),t.status==="completed"&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.recording_link&&e.jsx("a",{href:t.recording_link,target:"_blank",title:"Ada Rekaman",className:"text-purple-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),t.therapist_notes&&e.jsx("span",{title:"Ada Catatan Klinis",className:"text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),t.patient_visible_notes&&e.jsx("span",{title:"Ada Pesan untuk Pasien",className:"text-blue-500",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v===t.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",value:m.therapist_id,onChange:s=>p("therapist_id",s.target.value),children:[e.jsx("option",{value:"",children:"Pilih Terapis"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:()=>T(t.id),className:"px-3 py-1 bg-indigo-600 text-white text-xs rounded-md hover:bg-indigo-700 disabled:opacity-50",disabled:u||!m.therapist_id,children:"Simpan"}),e.jsx("button",{onClick:()=>l(null),className:"px-3 py-1 bg-gray-200 text-gray-700 text-xs rounded-md hover:bg-gray-300",disabled:u,children:"Batal"})]}):e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsx("span",{className:t.therapist?"text-gray-900 font-medium text-xs":"text-gray-400 italic text-xs",children:t.therapist?.name||"Belum di-assign"}),e.jsx("button",{onClick:()=>{l(t.id),p("therapist_id",t.therapist_id||"")},className:"ml-2 text-indigo-600 hover:text-indigo-900 text-[11px] opacity-0 group-hover:opacity-100 transition-opacity",children:t.therapist?"Ubah":"Assign"})]}),["confirmed","in_progress"].includes(t.status)&&e.jsxs("div",{className:"flex gap-1.5 mt-1",children:[e.jsx("button",{onClick:()=>n(t),className:"px-2 py-0.5 bg-amber-50 text-amber-700 border border-amber-200 rounded text-[10px] font-bold hover:bg-amber-100 transition-colors",children:"Reschedule"}),e.jsx("button",{onClick:()=>r(t),className:"px-2 py-0.5 bg-red-50 text-red-700 border border-red-200 rounded text-[10px] font-bold hover:bg-red-100 transition-colors",children:"No-Show"})]})]})})]},t.id)),h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"Belum ada booking pasien."})})]})]})})})})}),e.jsx(f,{show:a!==null,onClose:()=>n(null),children:e.jsxs("form",{onSubmit:L,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-1",children:"Reschedule Sesi"}),e.jsxs("p",{className:"text-xs text-gray-500 mb-6",children:["Pasien: ",e.jsx("strong",{children:a?.patient?.name}),e.jsx("br",{}),"Jadwal saat ini: ",a?.schedule?.date," pukul ",a?.schedule?.start_time?.substring(0,5)]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(i,{htmlFor:"new_schedule_id",value:"Pilih Jadwal Baru"}),e.jsxs("select",{id:"new_schedule_id",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm",value:c.new_schedule_id,onChange:t=>g("new_schedule_id",t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Pilih Slot Tersedia --"}),N.filter(t=>t.id!==a?.schedule_id).map(t=>e.jsxs("option",{value:t.id,children:[t.therapist?.name," — ",new Date(t.date).toLocaleDateString("id-ID",{day:"numeric",month:"short"})," — ",t.start_time?.substring(0,5)]},t.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(i,{htmlFor:"reschedule_reason",value:"Alasan Reschedule"}),e.jsx("textarea",{id:"reschedule_reason",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm",rows:"2",placeholder:"Tuliskan alasan perubahan jadwal...",value:c.reschedule_reason,onChange:t=>g("reschedule_reason",t.target.value),required:!0}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"* Pesan ini akan diinformasikan ke pelanggan."})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(w,{onClick:()=>n(null),children:"Batal"}),e.jsx("button",{type:"submit",disabled:S||!c.new_schedule_id,className:"inline-flex items-center px-4 py-2 bg-amber-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-amber-700 disabled:opacity-25 transition",children:"Update Jadwal"})]})]})}),e.jsx(f,{show:d!==null,onClose:()=>r(null),children:e.jsxs("form",{onSubmit:M,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-1",children:"Tandai Tidak Hadir"}),e.jsxs("p",{className:"text-xs text-gray-500 mb-6",children:[" Booking Code: ",d?.booking_code," "]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(i,{htmlFor:"no_show_party",value:"Pihak yang Tidak Hadir"}),e.jsxs("select",{id:"no_show_party",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-red-500 focus:ring-red-500 text-sm",value:j.no_show_party,onChange:t=>y("no_show_party",t.target.value),required:!0,children:[e.jsx("option",{value:"therapist",children:"Praktisi (Tidak Hadir)"}),e.jsx("option",{value:"patient",children:"Pasien (Tidak Hadir)"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(i,{htmlFor:"no_show_reason",value:"Keterangan Admin"}),e.jsx("textarea",{id:"no_show_reason",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-red-500 focus:ring-red-500 text-sm",rows:"2",placeholder:"Alasan ketidakhadiran...",value:j.no_show_reason,onChange:t=>y("no_show_reason",t.target.value)})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(w,{onClick:()=>r(null),children:"Batal"}),e.jsx("button",{type:"submit",disabled:C,className:"inline-flex items-center px-4 py-2 bg-red-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-700 disabled:opacity-25 transition",children:"Tandai No-Show"})]})]})})]})}export{$ as default};
